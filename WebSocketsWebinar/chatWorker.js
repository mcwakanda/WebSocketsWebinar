//Message format {username: "***", type: "***", body: "***"}var allWebSockets = [];var broadcast = function(msg){	var toSend = JSON.stringify(msg);	allWebSockets.forEach(function(ws){		ws.postMessage(toSend);	});};onconnect = function(event){	var ws = event.ports[0];	allWebSockets.push(ws);	//new connection	ws.postMessage(JSON.stringify({		username: "defaultuser" + Math.floor(Math.random() * 1000),		type: "addUser"	}));		ws.onmessage = function(message){		var msgObj = JSON.parse(message.data);		switch(msgObj.type){			case "updateUsername":				broadcast({username: "System", type: "message", body: "A user has changed their name to: " + msgObj.username});				break;			case "message":				broadcast({username: msgObj.username, type: "message", body: msgObj.body});				break;		}	};};